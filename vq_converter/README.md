# PokeyVQ - Atari Audio Compressor & Player

A production-ready toolchain for compressing audio and playing it back on Atari 8-bit computers using POKEY.

## Features
- **VQ Compression**: Variable-rate Vector Quantization for high quality at low bitrates (~4-6KB/s).
- **Raw Mode**: Pure POKEY playback for maximum quality (high memory usage).
- **Sliding Window**: Advanced VQ for longer streams.
- **Audio Enhancement**: automatic normalization, limiting, and EQ.
- **Pokey Simulation**: Generates WAV files simulating POKEY hardware quirks.

## Installation

### Prerequisites
- Python 3.8 or higher

### Quick Setup (Recommended)
It is recommended to use a virtual environment.

#### Windows
```powershell
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
```

#### Linux / macOS
```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### Running from Source
You can run the tools directly from Python without building.

**GUI (Graphical Interface):**
```bash
python -m pokey_vq.gui
```

**CLI (Command Line):**
```bash
python -m pokey_vq.cli --help
```

### Building Standalone App
To build a single-file executable for your current platform:

```bash
python build_app.py
```

**Options:**
- `python build_app.py --all`: Attempt to build for all known targets (will skip those incompatible with your current OS).
- `python build_app.py windows_x86_64`: Request a specific target.
- `python build_app.py --help`: Show available targets and options.

**Note on Cross-Compilation:**
PyInstaller generally requires running on the target OS to build a standalone executable (e.g., you must run on Windows to build `.exe`). The build script will automatically detect your OS and warn/skip if you try to build an incompatible target.

**Output:**
Executables are generated in platform-specific directories:
- `dist/linux_x86_64/pokey_vq`
- `dist/windows_x86_64/pokey_vq.exe`
- `dist/macos_x86_64/pokey_vq`



## Usage

Run the compressor using the module entry point:

```bash
python3 -m pokey_vq.cli [input_file] [options]
```

### Examples

**Standard Compression (Music):**
```bash
python3 -m pokey_vq.cli music.mp3 -o music.xex
```

**High Quality (Speech):**
```bash
python3 -m pokey_vq.cli speech.wav -r 4000 --quality 100 -o speech.xex
```

**Raw Playback (No compression):**
```bash
python3 -m pokey_vq.cli sfx.wav --raw -o sfx.xex
```

### Options
- `-o, --output`: Output filename (.xex will be generated).
- `-r, --rate`: Target sample rate (snaps to POKEY divisors).
- `-q, --quality`: encoding quality (0-100).
- `--enhance`: Apply audio enhancements (limiter, high-pass).
- `--sliding-window`: Use sliding window VQ (for longer files).
- `--optimize`: `size` (smaller file, slower) or `speed` (larger file, faster).
- `--hifi`: Enable 5-bit Dual Channel mode (better quality, higher CPU).

## Project Structure
- `pokey_vq/`: Source code package.
- `players/`: 6502 Assembly player source code (modular `lib/` and unified `player.asm`).
- `bin/`: Assembler binaries (MADS).
- `examples/`: Sample audio and outputs.

## Embedding in Your Project
The player core is available as a reusable library in `players/lib/vq_player.asm`.
1. Copy `players/lib/` to your project.
2. Include `VQ_CFG.asm` (generated by the encoder).
3. Include `lib/vq_player.asm`.
4. Call `jsr PokeyVQ_Init` in your startup and `jsr PokeyVQ_IRQ` in your interrupt handler.
